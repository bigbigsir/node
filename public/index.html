<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsencrypt@3.0.0-rc.1/bin/jsencrypt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>
</head>
<body>
<img id="img" src="" alt="">
<div id="div"></div>
<button id="button">发送请求</button>
<button id="node">更新node代码</button>
<button id="react">更新react代码</button>
<div>
  <pre id="nodePre"></pre>
</div>
<div>
  <pre id="reactPre"></pre>
</div>
<script>
  const key = 'MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDTacKAITLQ0GC8BJ0Jy/0EkSv1yDTI77rtpO9+99dhRYRyRoAGnzrzZpo+0+i7TQwULxJAN43IvRHstpK/YmGjH4jXTPtTNWhJZR5OJ8e0lUT36WYLLR5f2LxwJZ+ftrUMj719EM6TYz51paTUI7UE3WkPHzPmmjhDXR7L7JBmKwIDAQAB'
  const crypto = new JSEncrypt()
  crypto.setPublicKey(key)
  let token = null
  $('#button').on('click', function () {
    let data = {}
    const token = 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1OTExMDg0NjMsImlwIjoiMTkyLjE2OC4yNTQuMTA1In0.gcH5tr6Iv_ym6icmhFYLwg5-6mLT2NVDf367y9cnPr4EbgzpkigqLmqQENC8Rok7MunXeRcD6-yK3uBOKpZpeI3UN_y2cnBEZVeJC2NdMbYmy5-fSCZ44nSho-mq6knQ37Vg43OVdKVLu_WTP08THiZ9kT-5tZQN05sgATQAcH4'
    data = JSON.stringify(data)
    const qid = md5(Date.now() + Math.random() + '')
    const sign = md5(qid + reverseString(data) + token)
    $.ajax({
      type: 'post',
      url: '/test',
      headers: {
        token,
        qid,
        sign
      },
      contentType: 'application/json;charset=UTF-8',
      data: data,
      success (data) {
        console.log(data)
      }
    })
  })
  getWebToken()

  function getWebToken () {
    let data = {}
    data = JSON.stringify(data)
    const qid = md5(Date.now() + Math.random() + '')
    const sign = md5(qid + reverseString(data) + token)
    $.ajax({
      type: 'post',
      url: '/common/getWebToken',
      headers: {
        token: token,
        qid: qid,
        sign: sign
      },
      data,
      contentType: 'application/json;charset=UTF-8',
      success ({ data }) {
        token = data
        signIn(token)
        // signUp(token)
        getCaptcha(token)
      }
    })
  }

  function getCaptcha (token) {
    let data = {}
    data = JSON.stringify(data)
    const qid = md5(Date.now() + Math.random() + '')
    const sign = md5(qid + reverseString(data) + token)
    $.ajax({
      type: 'post',
      url: '/common/getCaptcha',
      headers: {
        token: token,
        qid: qid,
        sign: sign
      },
      data,
      contentType: 'application/json;charset=UTF-8',
      success ({ data }) {
        document.getElementById('div').innerHTML = data.image
        verifyCaptcha(token)
      }
    })
  }

  function verifyCaptcha (token) {
    let data = {
      captchaId: '5ed86d11a0e60b3b69df8620',
      captcha: '12'
    }
    data = JSON.stringify(data)
    const qid = md5(Date.now() + Math.random() + '')
    const sign = md5(qid + reverseString(data) + token)
    $.ajax({
      type: 'post',
      url: '/common/verifyCaptcha',
      headers: {
        token: token,
        qid: qid,
        sign: sign
      },
      data,
      contentType: 'application/json;charset=UTF-8',
      success ({ data }) {
      }
    })
  }

  function signIn (token) {
    let data = {
      username: 'admin1591177482319',
      password: crypto.encrypt('123456')
    }
    data = JSON.stringify(data)
    const qid = md5(Date.now() + Math.random() + '')
    const sign = md5(qid + reverseString(data) + token)
    $.ajax({
      type: 'post',
      url: '/users/signIn',
      headers: {
        appId: 'PC01',
        token: token,
        qid: qid,
        sign: sign
      },
      data,
      contentType: 'application/json;charset=UTF-8',
      success (data) {
        signOut()
        // getUserInfo()
        setTimeout(() => getUserInfo(), 4)
      }
    })
  }

  function signUp (token) {
    let data = {
      username: 'admin' + Date.now(),
      password: crypto.encrypt('123456'),
      email: '519628061@qq.com'
    }
    data = JSON.stringify(data)
    const qid = md5(Date.now() + Math.random() + '')
    const sign = md5(qid + reverseString(data) + token)
    $.ajax({
      type: 'post',
      url: '/users/signUp',
      headers: {
        appId: 'PC01',
        token: token,
        qid: qid,
        sign: sign
      },
      data,
      contentType: 'application/json;charset=UTF-8',
      success (data) {
        console.log(data)
      }
    })
  }

  function signOut () {
    let data = {
      username: 'admin1591177482319'
    }
    data = JSON.stringify(data)
    const qid = md5(Date.now() + Math.random() + '')
    const sign = md5(qid + reverseString(data) + token)
    $.ajax({
      type: 'post',
      url: '/users/signOut',
      headers: {
        appId: 'PC01',
        token: token,
        qid: qid,
        sign: sign
      },
      data,
      contentType: 'application/json;charset=UTF-8',
      success (data) {
      }
    })
  }

  function getUserInfo () {
    // token = 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1OTExNzQzNzMsImlwIjoiMTkyLjE2OC4yNTQuMTA1In0.O8EXjkgtaHelDlmk8w-8z89-GjzvKc-Z4RWHonFCWExOF8eWxvmmNU_trqXj3d3tW9nYiHah_6TlL2Hu-aBsGEd2ghvrrz4hNGG2m-tCpDtA9EtJMclqzrcj2w6P4xBhyxQSvNxeXITTzPH6hG9DLMQKFDCClSRJGF-CrBtFw4g'
    let data = {
      username: 'admin1591177482319'
    }
    data = JSON.stringify(data)
    const qid = md5(Date.now() + Math.random() + '')
    const sign = md5(qid + reverseString(data) + token)
    $.ajax({
      type: 'post',
      url: '/users/getUserInfo',
      headers: {
        appId: 'PC01',
        token: token,
        qid: qid,
        sign: sign
      },
      data,
      contentType: 'application/json;charset=UTF-8',
      success (data) {
        console.log(data)
      }
    })
  }

  function reverseString (string = '') {
    return string.toString().split('').sort().reverse().join('')
  }
</script>
<script>
  const data = {
    'ref': 'refs/heads/master',
    'before': '27843140bdbcbf82157d5edd4963385e1a316c89',
    'after': '648ec954aa3f3888bf2f26b89ff862ac8d92158d',
    'repository': {
      'id': 166796615,
      'node_id': 'MDEwOlJlcG9zaXRvcnkxNjY3OTY2MTU=',
      'name': 'nodeJs',
      'full_name': 'bigbigsir/nodeJs',
      'private': false,
      'owner': {
        'name': 'bigbigsir',
        'email': '519628061@qq.com',
        'login': 'bigbigsir',
        'id': 30718335,
        'node_id': 'MDQ6VXNlcjMwNzE4MzM1',
        'avatar_url': 'https://avatars0.githubusercontent.com/u/30718335?v=4',
        'gravatar_id': '',
        'url': 'https://api.github.com/users/bigbigsir',
        'html_url': 'https://github.com/bigbigsir',
        'followers_url': 'https://api.github.com/users/bigbigsir/followers',
        'following_url': 'https://api.github.com/users/bigbigsir/following{/other_user}',
        'gists_url': 'https://api.github.com/users/bigbigsir/gists{/gist_id}',
        'starred_url': 'https://api.github.com/users/bigbigsir/starred{/owner}{/repo}',
        'subscriptions_url': 'https://api.github.com/users/bigbigsir/subscriptions',
        'organizations_url': 'https://api.github.com/users/bigbigsir/orgs',
        'repos_url': 'https://api.github.com/users/bigbigsir/repos',
        'events_url': 'https://api.github.com/users/bigbigsir/events{/privacy}',
        'received_events_url': 'https://api.github.com/users/bigbigsir/received_events',
        'type': 'User',
        'site_admin': false
      },
      'html_url': 'https://github.com/bigbigsir/nodeJs',
      'description': 'Node+Express+MongoDB实现的后台服务',
      'fork': false,
      'url': 'https://github.com/bigbigsir/nodeJs',
      'forks_url': 'https://api.github.com/repos/bigbigsir/nodeJs/forks',
      'keys_url': 'https://api.github.com/repos/bigbigsir/nodeJs/keys{/key_id}',
      'collaborators_url': 'https://api.github.com/repos/bigbigsir/nodeJs/collaborators{/collaborator}',
      'teams_url': 'https://api.github.com/repos/bigbigsir/nodeJs/teams',
      'hooks_url': 'https://api.github.com/repos/bigbigsir/nodeJs/hooks',
      'issue_events_url': 'https://api.github.com/repos/bigbigsir/nodeJs/issues/events{/number}',
      'events_url': 'https://api.github.com/repos/bigbigsir/nodeJs/events',
      'assignees_url': 'https://api.github.com/repos/bigbigsir/nodeJs/assignees{/user}',
      'branches_url': 'https://api.github.com/repos/bigbigsir/nodeJs/branches{/branch}',
      'tags_url': 'https://api.github.com/repos/bigbigsir/nodeJs/tags',
      'blobs_url': 'https://api.github.com/repos/bigbigsir/nodeJs/git/blobs{/sha}',
      'git_tags_url': 'https://api.github.com/repos/bigbigsir/nodeJs/git/tags{/sha}',
      'git_refs_url': 'https://api.github.com/repos/bigbigsir/nodeJs/git/refs{/sha}',
      'trees_url': 'https://api.github.com/repos/bigbigsir/nodeJs/git/trees{/sha}',
      'statuses_url': 'https://api.github.com/repos/bigbigsir/nodeJs/statuses/{sha}',
      'languages_url': 'https://api.github.com/repos/bigbigsir/nodeJs/languages',
      'stargazers_url': 'https://api.github.com/repos/bigbigsir/nodeJs/stargazers',
      'contributors_url': 'https://api.github.com/repos/bigbigsir/nodeJs/contributors',
      'subscribers_url': 'https://api.github.com/repos/bigbigsir/nodeJs/subscribers',
      'subscription_url': 'https://api.github.com/repos/bigbigsir/nodeJs/subscription',
      'commits_url': 'https://api.github.com/repos/bigbigsir/nodeJs/commits{/sha}',
      'git_commits_url': 'https://api.github.com/repos/bigbigsir/nodeJs/git/commits{/sha}',
      'comments_url': 'https://api.github.com/repos/bigbigsir/nodeJs/comments{/number}',
      'issue_comment_url': 'https://api.github.com/repos/bigbigsir/nodeJs/issues/comments{/number}',
      'contents_url': 'https://api.github.com/repos/bigbigsir/nodeJs/contents/{+path}',
      'compare_url': 'https://api.github.com/repos/bigbigsir/nodeJs/compare/{base}...{head}',
      'merges_url': 'https://api.github.com/repos/bigbigsir/nodeJs/merges',
      'archive_url': 'https://api.github.com/repos/bigbigsir/nodeJs/{archive_format}{/ref}',
      'downloads_url': 'https://api.github.com/repos/bigbigsir/nodeJs/downloads',
      'issues_url': 'https://api.github.com/repos/bigbigsir/nodeJs/issues{/number}',
      'pulls_url': 'https://api.github.com/repos/bigbigsir/nodeJs/pulls{/number}',
      'milestones_url': 'https://api.github.com/repos/bigbigsir/nodeJs/milestones{/number}',
      'notifications_url': 'https://api.github.com/repos/bigbigsir/nodeJs/notifications{?since,all,participating}',
      'labels_url': 'https://api.github.com/repos/bigbigsir/nodeJs/labels{/name}',
      'releases_url': 'https://api.github.com/repos/bigbigsir/nodeJs/releases{/id}',
      'deployments_url': 'https://api.github.com/repos/bigbigsir/nodeJs/deployments',
      'created_at': 1548067217,
      'updated_at': '2020-05-27T12:07:15Z',
      'pushed_at': 1590590479,
      'git_url': 'git://github.com/bigbigsir/nodeJs.git',
      'ssh_url': 'git@github.com:bigbigsir/nodeJs.git',
      'clone_url': 'https://github.com/bigbigsir/nodeJs.git',
      'svn_url': 'https://github.com/bigbigsir/nodeJs',
      'homepage': '',
      'size': 75713,
      'stargazers_count': 2,
      'watchers_count': 2,
      'language': 'JavaScript',
      'has_issues': true,
      'has_projects': true,
      'has_downloads': true,
      'has_wiki': true,
      'has_pages': false,
      'forks_count': 0,
      'mirror_url': null,
      'archived': false,
      'disabled': false,
      'open_issues_count': 0,
      'license': null,
      'forks': 0,
      'open_issues': 0,
      'watchers': 2,
      'default_branch': 'master',
      'stargazers': 2,
      'master_branch': 'master'
    },
    'pusher': {
      'name': 'bigbigsir',
      'email': '519628061@qq.com'
    },
    'sender': {
      'login': 'bigbigsir',
      'id': 30718335,
      'node_id': 'MDQ6VXNlcjMwNzE4MzM1',
      'avatar_url': 'https://avatars0.githubusercontent.com/u/30718335?v=4',
      'gravatar_id': '',
      'url': 'https://api.github.com/users/bigbigsir',
      'html_url': 'https://github.com/bigbigsir',
      'followers_url': 'https://api.github.com/users/bigbigsir/followers',
      'following_url': 'https://api.github.com/users/bigbigsir/following{/other_user}',
      'gists_url': 'https://api.github.com/users/bigbigsir/gists{/gist_id}',
      'starred_url': 'https://api.github.com/users/bigbigsir/starred{/owner}{/repo}',
      'subscriptions_url': 'https://api.github.com/users/bigbigsir/subscriptions',
      'organizations_url': 'https://api.github.com/users/bigbigsir/orgs',
      'repos_url': 'https://api.github.com/users/bigbigsir/repos',
      'events_url': 'https://api.github.com/users/bigbigsir/events{/privacy}',
      'received_events_url': 'https://api.github.com/users/bigbigsir/received_events',
      'type': 'User',
      'site_admin': false
    },
    'created': false,
    'deleted': false,
    'forced': false,
    'base_ref': null,
    'compare': 'https://github.com/bigbigsir/nodeJs/compare/27843140bdbc...648ec954aa3f',
    'commits': [
      {
        'id': '648ec954aa3f3888bf2f26b89ff862ac8d92158d',
        'tree_id': '226c42edbd3fa380de2ff7770317fc914f98f473',
        'distinct': true,
        'message': '‘update’',
        'timestamp': '2020-05-27T22:41:13+08:00',
        'url': 'https://github.com/bigbigsir/nodeJs/commit/648ec954aa3f3888bf2f26b89ff862ac8d92158d',
        'author': {
          'name': 'emoji',
          'email': '519628061@qq.com',
          'username': 'bigbigsir'
        },
        'committer': {
          'name': 'emoji',
          'email': '519628061@qq.com',
          'username': 'bigbigsir'
        },
        'added': [
          'github_push.sh',
          'routes/util/handels.js',
          'routes/util/index.js'
        ],
        'removed': [
          'routes/util.js'
        ],
        'modified': [
          'app.js',
          'package.json',
          'pm2.json',
          'port_3000.js',
          'port_4000.js',
          'port_80.js',
          'public/index.html'
        ]
      }
    ],
    'head_commit': {
      'id': '648ec954aa3f3888bf2f26b89ff862ac8d92158d',
      'tree_id': '226c42edbd3fa380de2ff7770317fc914f98f473',
      'distinct': true,
      'message': '‘update’',
      'timestamp': '2020-05-27T22:41:13+08:00',
      'url': 'https://github.com/bigbigsir/nodeJs/commit/648ec954aa3f3888bf2f26b89ff862ac8d92158d',
      'author': {
        'name': 'emoji',
        'email': '519628061@qq.com',
        'username': 'bigbigsir'
      },
      'committer': {
        'name': 'emoji',
        'email': '519628061@qq.com',
        'username': 'bigbigsir'
      },
      'added': [
        'github_push.sh',
        'routes/util/handels.js',
        'routes/util/index.js'
      ],
      'removed': [
        'routes/util.js'
      ],
      'modified': [
        'app.js',
        'package.json',
        'pm2.json',
        'port_3000.js',
        'port_4000.js',
        'port_80.js',
        'public/index.html'
      ]
    }
  }
  $('#node').on('click', function () {
    $.ajax({
      type: 'post',
      url: '/webHooks/projectNode',
      headers: {
        'X-GitHub-Delivery': '9f0313d0-9fde-11ea-9340-c0ca531bde33',
        'X-GitHub-Event': 'push',
        'X-Hub-Signature': 'sha1=df1f7c9ec09d3dc892b7ced630347dfc9b9581d2'
      },
      contentType: 'application/json;charset=UTF-8',
      data: JSON.stringify(data),
      success (data) {
        if (data.code === '0') {
          document.getElementById('nodePre').innerText = data.data
        }
        console.log(data)
      }
    })
  })
  $('#react').on('click', function () {
    $.ajax({
      type: 'post',
      url: '/webHooks/projectReactWeb',
      headers: {
        'X-GitHub-Event': 'push',
        'X-Hub-Signature': 'sha1=df1f7c9ec09d3dc892b7ced630347dfc9b9581d2'
      },
      contentType: 'application/json;charset=UTF-8',
      data: JSON.stringify(data),
      success (data) {
        if (data.code === '0') {
          document.getElementById('reactPre').innerText = data.data
        }
        console.log(data)
      }
    })
  })
</script>
</body>
</html>
